{% extends "base.j2" %}

{% block title %}Capture Race Results{% endblock %}

{% block styles %}
{% include 'common/datatables-css.j2' %}
{% endblock %}

{% block content %}

<h1>Capture Race Results</h1>  

<div class="row">
    <div class="col-sm-12">
        <table id="entries" class="table table-striped" style="width:100%">
            <thead>
                <tr>
                    <th></th>
                    <th>Race #</th>
                    <th>Paddlers</th>
                    <th>Start Time</th>
                    <th>Finish Time</th>
                </tr>
            </thead>
            <tbody>
        {% for entry in entries %}
                <tr>
                    <td>{{ entry.entry_number }}</td>
                    <td></td>
                    <td><a href="{{ url_for('entry', entry_id=entry.id) }}">{{ entry }}</a></td>
                    <!-- <td><input type="time" class="form-control" id="start_{{ entry.id }}" step="30"></td>
                    <td><input type="time" class="form-control" id="finish" step="1"></td> -->
                    <td>
                        <div class="edit">{{ entry.time_start }}</div>
                        <input type="text" class="form-control txtedit" value="{{ entry.time_start }}" id="start_{{ entry.id }}">
                    </td>
                    <td>
                        <div class="edit">{{ entry.time_finish }}</div>
                        <input type="text" class="form-control txtedit" value="{{ entry.time_finish }}" id="finish_{{ entry.id }}">
                    </td>
                </tr>
        {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}

{% block scripts %}
{% include 'common/jquery-javascript.j2' %}
{% include 'common/datatables-javascript.j2' %}
<script type="text/javascript" class="init">
$(document).ready(function () {
	$('#entries').DataTable({
        paging: false,
        columns: [
          null,
          null,
          null,
          {orderable: false, searchable: false},
          {orderable: false, searchable: false}
        ]
    });

    // Show input element.
    $('.edit').click(function() {
        $('.txtedit').hide();
        $(this).next('.txtedit').show().focus();
        $(this).hide();
    });

    // SAve data.
    $(".txtedit").focusout(function() {
        var id = this.id;
        var split_id = id.split("_");
        var field_name = split_id[0];
        var edit_id = split_id[1];
        var value = $(this).val();

        $(this).hide();

        $(this).prev(".edit").show();
        $(this).prev(".edit").text(value);

        $.ajax({
            url: "/update",
            type: "post",
            data: { field: field_name, value: value, edit_id: edit_id},
            success: function(response) {
                if (response == 1) {
                    console.log("Saved successfully.");
                } else {
                    console.log("Not saved.");
                }
            }
        });
    });
});
</script>
{% endblock %}