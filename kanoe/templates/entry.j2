{% extends "base-fluid.j2" %}
{% from "macros.j2" import find_value %}

{% block title %}Entry{% endblock %}

{% block content %}

<h1>Entry</h1>

<div class="row">
  <div class="col-md-3">
    <h3>Details</h3>
    <form method="post">
      <div>
        <div class="mb-3">
          <label for="race">Race</label>
          <select class="form-select" class="form-control" id="race_id" name="race_id" {% if entry %} disabled{% endif
            %}>
            {% for race in races %}
            <option value="{{ race.id }}" {% if entry.race==race %} selected{% endif %}>{{ race }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="mb-3">
          <label for="race">Category</label>
          <select class="form-select" class="form-control" id="category_id" name="category_id">
            {% for category in categories %}
            <option value="{{ category.id }}" {% if (entry.category==category) %} selected{% endif %}>{{ category }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="mb-3">
          <label for="division">Division</label>
          <input type="number" class="form-control" disabled
            value="{{ find_value(request.form['division'], entry.division) }}">
        </div>
        <div class="mb-3">
          <label for="division">Race Number</label>
          <input type="number" class="form-control" disabled value="{{ entry.race_number }}">
        </div>
        <div>
          <label for="services">Services</label>
          <input type="checkbox" disabled{% if entry.services %} checked{% endif %} style="float: right;">
        </div>
        <div>
          <label for="registered">Registered</label>
          <input type="checkbox" disabled{% if entry.registered %} checked{% endif %} style="float: right;">
        </div>
      </div>
      <hr class="my-4">
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
  </div>
  <div class="col-md-4">
    <h3>Crew</h3>
    {% for crew in entry.crews %}
    <div class="h-30 p-3 mb-2 bg-light border rounded-3">
      <div class="row">
        <div class="col-md-8">
          <h3><a href="{{ url_for('kanoe.paddler', paddler_id=crew.paddler.id) }}">{{ crew.paddler.name }}</a></h3>
          <table class="table table-sm table-borderless">
            <tr>
              <th>Club</th>
              <td style="text-align: right;">
                <a href="{{ url_for('kanoe.club', club_id=crew.club.id) }}">{{ crew.club.id }}</a>
              </td>
            </tr>
            <tr>
              <th>Division</th>
              <td style="text-align: right;">{{ crew.paddler.division or "" }}</td>
            </tr>
            <tr>
              <th>Team</th>
              <td style="text-align: right;">
                <a href="{{ url_for('kanoe.team', team_id=crew.team.id) }}">
                  {{ crew.team or "" }}
                </a>
              </td>
            </tr>
            <tr>
              <th>Services</th>
              <td style="text-align: right;" class="services">
                {% if crew.services %}<i class="fas fa-check"></i>{% endif %}
              </td>
            </tr>
          </table>
        </div>
        <div class="col-md-4">
          <ul class="nav flex-column">
            <li class="nav-item d-grid mb-2">
              <a href="{{ url_for('kanoe.crew', crew_id=crew.id) }}" class="btn btn-primary">Edit Crew</a>
            </li>
            <li class="nav-item d-grid mb-2">
              <a href="{{ url_for('kanoe.crew_delete', crew_id=crew.id) }}" class="btn btn-danger">Remove Crew</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    {% endfor %}
    {% if entry %}
    {% if not entry.crew_complete %}
    <a href="{{ url_for('kanoe.entry_crew_add', entry_id=entry.id) }}" class="btn btn-primary">Add Crew</a>
    {% endif %}
    {% endif %}
  </div>
  <div class="col-md-4">
    <h3>Times</h3>
    <div class="times">
      {% if entry.time %}
      <div class="time-elapsed">
        {{ entry.time }}
      </div>
      <div class="text-muted">Elapsed Time</div>
      {% endif %}
      <div class="mt-4">
        {% if entry.time_start %}
        <div class="time-start-finish">
          {{ entry.time_start }}
        </div>
        <div class="text-muted">Start Time</div>
        {% endif %}
        {% if entry.time_finish %}
        <div class="time-start-finish mt-1">
          {{ entry.time_finish }}
        </div>
        <div class="text-muted">Finish Time</div>
        {% endif %}
      </div>
    </div>
    {% if entry.note %}
    <div class="p-3 mt-2 bg-info text-black">
      <i class="fas fa-bell"></i> <strong>Note:</strong> {{ entry.note }}
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block sidebar %}
{% include 'sidebar-entry.j2' %}
{% endblock %}
