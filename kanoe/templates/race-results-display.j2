{% extends "base-plain.j2" %}

{% block title %}Results: {{ race.name }} ({{ race.date }}){% endblock %}

{% block styles %}
    <link rel="stylesheet" type="text/css" href="/css/styles-results.css">
{% endblock %}

{% block content %}

{% if categories %}
<h1>Results: {{ race.name }} ({{ race.date }})</h1>

{% for category, results in categories.items() %}
<h2>{{ category }}</h2>

<table class="table result">
    <thead>
        <tr>
            <th>Position</th>
            <th>Race #</th>
            <th>Paddler(s)</th>
            <th>Team</th>
            <th class="services">Services</th>
            <th>Time</th>
        </tr>
    </thead>
    <tbody>
    {% for result in results %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ result.race_number or "" }}</td>
            <td>{{ result }}</td>
            <td>{{ result.team or "" }}</td>
            <td class="services">{% if result.services %}<i class="fas fa-check"></i>{% endif %}</td>
            <td>{{ result.time }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endfor %}

{% else %}
<div class="results missing">
<p>No results yet...<br><i class="fas fa-circle-notch fa-spin"></i></p>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
    {# Only scroll and reload if there are results. Will need to refresh page to get this started. #}
    {% if categories %}
<script type="text/javascript" class="init">
var scroll = setInterval(function() {
        // Scroll slowly down page.
        window.scrollBy(0, 10);
        // Hard reload page at bottom.
        if ((window.innerHeight + window.scrollY) >= document.body.scrollHeight) {
            setTimeout(() => { location.reload(true); }, 2000);
        }
    },
    100
);
</script>
    {% endif %}
{% endblock %}